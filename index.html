<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<link rel="manifest" href="/youtube888/manifest.json"/>
<link rel="icon" type="image/png" sizes="192x192" href="/youtube888/icons/logo-192.png"/>
<link rel="apple-touch-icon" href="/youtube888/icons/logo-512.png"/>
<meta name="theme-color" content="#ff0000"/>

<title>Buscador YouTube Amorim</title>

<style>
body {
  background:#111;color:#fff;font-family:Arial;margin:0;padding:20px;
  transition:0.3s;
}
.light {background:#f2f2f2;color:#000;}
h1{text-align:center;color:#ff0000;margin-top:0;}

.controls {display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px;}
.controls input, .controls button {
  padding:12px;font-size:16px;border:none;border-radius:6px;
}
.controls input{flex:1;background:#222;color:#fff;}
.light .controls input{background:#ddd;color:#000;}
.controls button{background:#ff0000;color:white;cursor:pointer;}
#toggle{background:#444;}
.light #toggle{background:#999;color:black;}

.grid {
  display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
  gap:20px;
}

.card {
  background:#1a1a1a;border-radius:12px;padding:12px;
  box-shadow:0 0 10px #000;transition:0.3s;
}
.light .card{background:#fff;box-shadow:0 0 10px #999;}
.card:hover {transform:scale(1.03);}

.card img {
  width:100%;border-radius:10px;cursor:pointer;background:#000;
}

.downloads button {
  padding:8px;margin-top:6px;margin-right:6px;background:#333;
  color:white;border:none;border-radius:6px;cursor:pointer;
}
.light .downloads button{background:#666;}

.selo-ptbr {
  margin-top:6px;
  padding:4px 8px;
  display:inline-block;
  background:#008000;
  color:white;
  border-radius:6px;
  font-size:13px;
}

#loader{text-align:center;margin:10px;font-size:18px;display:none;}
</style>
</head>

<body>

<h1>Buscador YouTube Amorim</h1>

<div class="controls">
 <input id="query" placeholder="Buscar v√≠deos..."/>
 <button onclick="buscarVideos(true)">Buscar</button>
 <button id="toggle" onclick="document.body.classList.toggle('light')">Modo Claro/Escuro</button>
</div>

<div id="loader">üîé Carregando‚Ä¶</div>

<div id="resultados" class="grid"></div>

<script>
const API_KEY="AIzaSyCdYsIw8W9CyV2GF9w7a96eeIAMOyH5TxU";
let nextPageToken="";
let loading=false;

const FALLBACK_IMG="https://i.ytimg.com/vi_webp/404/maxresdefault.webp";

// ------- FORMATADORES -------
function formatViews(n){
  if(!n) return "‚Äî";
  if(n>=1e6) return (n/1e6).toFixed(1).replace(".", ",")+" mi";
  if(n>=1e3) return (n/1e3).toFixed(1).replace(".", ",")+" mil";
  return n;
}
function tempoDesde(iso){
  const d=new Date(iso);const diff=Date.now()-d;const dias=diff/86400000;
  if(dias>=365) return `h√° ${Math.floor(dias/365)} anos`;
  if(dias>=30) return `h√° ${Math.floor(dias/30)} meses`;
  return `h√° ${Math.floor(dias)} dias`;
}

// ------- CARD 100% SEGURO -------
function cardHTML(v){
  const id = v.id?.videoId || v.id;  
  const title = v.snippet?.title || "V√≠deo sem t√≠tulo";
  const img = v.snippet?.thumbnails?.high?.url || FALLBACK_IMG;

  const views = formatViews(v.statistics?.viewCount);
  const age = v.snippet?.publishedAt ? tempoDesde(v.snippet.publishedAt) : "‚Äî";

  // Detec√ß√£o segura PT-BR
  let hasPTBR = false;
  const lang1 = v.snippet?.defaultAudioLanguage;
  if(lang1 === "pt-BR") hasPTBR = true;

  const selo = hasPTBR ? `<div class='selo-ptbr'>üéß √Åudio PT-BR dispon√≠vel</div>` : "";
  const botao = hasPTBR
    ? `<button class="downloads" style="background:#d40000" onclick="window.open('https://www.youtube.com/watch?v=${id}&hl=pt','_blank')">Assistir Dublado</button>`
    : "";

  return `
  <div class="card">
    <img src="${img}" 
         title="https://www.youtube.com/watch?v=${id}"
         onclick="window.open('https://www.youtube.com/watch?v=${id}','_blank')">

    <h3>${title}</h3>
    <p style="opacity:.8">${views} visualiza√ß√µes ‚Ä¢ ${age}</p>

    ${selo}
    ${botao}

    <div class="downloads">
      <button onclick="window.open('https://www.yout-ube.com/watch?v=${id}','_blank')">MP4</button>
      <button onclick="window.open('https://y2meta.is/?url=https://www.youtube.com/watch?v=${id}','_blank')">MP3</button>
      <button onclick="window.open('https://downsub.com/?url=https://www.youtube.com/watch?v=${id}','_blank')">Legenda (VTT)</button>
    </div>
  </div>`;
}

// ------- BUSCA -------
function buscarVideos(reset=true){
  const q=document.getElementById("query").value.trim();
  if(!q) return alert("Digite algo");

  if(loading) return;
  loading=true;
  document.getElementById("loader").style.display="block";

  if(reset){
    document.getElementById("resultados").innerHTML="";
    nextPageToken="";
  }

  let url=`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=20&q=${encodeURIComponent(q)}&key=${API_KEY}`;
  if(nextPageToken) url+=`&pageToken=${nextPageToken}`;

  fetch(url)
  .then(r=>r.json())
  .then(async data=>{
    nextPageToken=data.nextPageToken||"";

    const ids=data.items.map(v=>v.id.videoId).join(",");
    const info=await fetch(`https://www.googleapis.com/youtube/v3/videos?part=statistics,snippet&id=${ids}&key=${API_KEY}`)
                       .then(r=>r.json());

    const map={};
    info.items.forEach(x=>map[x.id]=x);

    const box=document.getElementById("resultados");
    data.items.forEach(v=>{
      const full = map[v.id.videoId] || v;
      box.innerHTML += cardHTML(full);
    });
  })
  .finally(()=>{
    loading=false;
    document.getElementById("loader").style.display="none";
  });
}

// ------- SCROLL INFINITO -------
window.addEventListener("scroll", ()=>{
  if(window.innerHeight + window.scrollY >= document.body.offsetHeight - 200){
    if(nextPageToken) buscarVideos(false);
  }
});
</script>
</body>
</html>
