<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<link rel="manifest" href="/youtube888/manifest.json"/>
<link rel="icon" type="image/png" sizes="192x192" href="/youtube888/icons/logo-192.png"/>
<link rel="apple-touch-icon" href="/youtube888/icons/logo-512.png"/>
<meta name="theme-color" content="#ff0000"/>

<title>Buscador YouTube Amorim</title>

<style>
body {
  background:#111;color:#fff;font-family:Arial;margin:0;padding:20px;
  transition:0.3s;
}
.light {background:#f2f2f2;color:#000;}

h1{text-align:center;color:#ff0000;margin-top:0;}

.controls {
  display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px;
}
.controls input, .controls button {
  padding:12px;font-size:16px;border:none;border-radius:6px;
}
.controls input{flex:1;background:#222;color:#fff;}
.light .controls input{background:#ddd;color:#000;}

.controls button{background:#ff0000;color:white;cursor:pointer;}
#toggle{background:#444;}
.light #toggle{background:#999;color:black;}

.grid {
  display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
  gap:20px;
}

.card {
  background:#1a1a1a;border-radius:12px;padding:12px;
  box-shadow:0 0 10px #000;transition:0.3s;
}
.light .card{background:#fff;box-shadow:0 0 10px #999;}

.card:hover {transform:scale(1.03);}

.card img {
  width:100%;border-radius:10px;cursor:pointer;
}

.downloads button {
  padding:8px;margin-top:6px;margin-right:6px;background:#333;
  color:white;border:none;border-radius:6px;cursor:pointer;
}
.light .downloads button{background:#666;}

#loader{text-align:center;margin:10px;font-size:18px;display:none;}
</style>
</head>

<body>

<h1>Buscador YouTube Amorim</h1>

<div class="controls">
 <input id="query" placeholder="Buscar v√≠deos..."/>
 <button onclick="buscarVideos(true)">Buscar</button>
 <button id="toggle" onclick="document.body.classList.toggle('light')">Modo Claro/Escuro</button>
</div>

<div id="loader">üîé Carregando‚Ä¶</div>

<div id="resultados" class="grid"></div>

<script>
const API_KEY="AIzaSyCdYsIw8W9CyV2GF9w7a96eeIAMOyH5TxU";
let nextPageToken="";
let loading=false;

// ‚ñ∫ 1. Formata visualiza√ß√µes (ex: 2,6 mi)
function formatViews(n){
  if(!n) return "‚Äî";
  if(n >= 1000000) return (n/1000000).toFixed(1).replace(".", ",") + " mi";
  if(n >= 1000) return (n/1000).toFixed(1).replace(".", ",") + " mil";
  return n;
}

// ‚ñ∫ 2. Calcula "h√° X anos/meses/dias"
function tempoDesde(dataISO){
  const d = new Date(dataISO);
  const diff = Date.now() - d;
  const dias = diff / (1000*60*60*24);

  if(dias >= 365) return `h√° ${Math.floor(dias/365)} anos`;
  if(dias >= 30) return `h√° ${Math.floor(dias/30)} meses`;
  return `h√° ${Math.floor(dias)} dias`;
}

// ‚ñ∫ 3. Card de v√≠deo + estat√≠sticas
function cardHTML(v){
  const id = v.id.videoId;
  const title = v.snippet.title;
  const img = v.snippet.thumbnails.high.url;

  const views = formatViews(v.statistics?.viewCount);
  const age = tempoDesde(v.snippet.publishedAt);

  return `
  <div class="card">
    <img src="${img}" onclick="window.open('https://y2meta.is/pt/youtube/${id}','_blank')"/>
    <h3>${title}</h3>

    <p style="opacity:.8">${views} visualiza√ß√µes ‚Ä¢ ${age}</p>

    <div class="downloads">
      <button onclick="window.open('https://www.yout-ube.com/watch?v=${id}','_blank')">MP4</button>
      <button onclick="window.open('https://y2meta.is/?url=https://www.youtube.com/watch?v=${id}','_blank')">MP3</button>
      <button onclick="window.open('https://downsub.com/?url=https://www.youtube.com/watch?v=${id}','_blank')">Legenda (VTT)</button>
    </div>
  </div>
  `;
}

// ‚ñ∫ 4. Busca v√≠deos + estat√≠sticas (duas chamadas)
function buscarVideos(reset=true){
  const q = document.getElementById("query").value.trim();
  if(!q) return alert("Digite algo");

  if(loading) return;
  loading = true;
  document.getElementById("loader").style.display="block";

  if(reset){
    document.getElementById("resultados").innerHTML="";
    nextPageToken="";
  }

  let url=`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=25&q=${encodeURIComponent(q)}&key=${API_KEY}`;
  if(nextPageToken) url += `&pageToken=${nextPageToken}`;

  fetch(url)
    .then(r=>r.json())
    .then(async data=>{
      nextPageToken = data.nextPageToken || "";

      // IDs para buscar estat√≠sticas
      const ids = data.items.map(v => v.id.videoId).join(",");

      const statsURL = `https://www.googleapis.com/youtube/v3/videos?part=statistics&id=${ids}&key=${API_KEY}`;
      const stats = await fetch(statsURL).then(r=>r.json());

      // Mapa de estat√≠sticas
      const statsMap = {};
      stats.items.forEach(s => statsMap[s.id] = s.statistics);

      // Atribui estat√≠sticas ao item
      data.items.forEach(v => v.statistics = statsMap[v.id.videoId]);

      const box = document.getElementById("resultados");
      data.items.forEach(v=> box.innerHTML += cardHTML(v));
    })
    .finally(()=>{
      loading=false;
      document.getElementById("loader").style.display="none";
    });
}

// ‚ñ∫ 5. Rolagem infinita
window.addEventListener("scroll",()=>{
  if(window.innerHeight + window.scrollY >= document.body.offsetHeight - 150){
    if(nextPageToken) buscarVideos(false);
  }
});

// ‚ñ∫ 6. PWA
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("/youtube888/service-worker.js");
}
</script>

</body>
</html>
